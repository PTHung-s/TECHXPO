<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Kiosk Bác sĩ Ảo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <style>
    :root {
      --bg-gradient: radial-gradient(circle at 30% 30%, #1e3a8a 0%, #0f172a 60%, #020617 100%);
      --panel: rgba(15,23,42,0.72);
      --glass: rgba(255,255,255,0.07);
      --border: rgba(255,255,255,0.12);
      --accent: #3b82f6;
      --accent-glow: 0 0 0 4px rgba(59,130,246,0.25);
      --ok:#10b981; --warn:#fbbf24; --err:#f87171;
      --danger:#ef4444;
      --font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    }
    * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html,body { margin:0; padding:0; font-family:var(--font); background:#020617; color:#f1f5f9; height:100%; }
    body { background-image:var(--bg-gradient); background-attachment:fixed; }
  h1 { font-size:1.15rem; margin:0; font-weight:650; letter-spacing:.6px; }
    button { cursor:pointer; font-weight:600; border:none; border-radius:1rem; padding:.75rem 1.15rem; font-size:.85rem; line-height:1; background:linear-gradient(135deg,#2563eb,#4f46e5); color:#fff; position:relative; overflow:hidden; }
    button:before { content:""; position:absolute; inset:0; background:linear-gradient(135deg,#60a5fa,#6366f1); opacity:0; transition:.4s; }
    button:hover:before { opacity:.15; }
    button:disabled { background:#334155; box-shadow:none; opacity:.5; }
    .pill { padding:.45rem .9rem; border-radius:2rem; font-size:.65rem; letter-spacing:.5px; font-weight:600; background:var(--glass); backdrop-filter:blur(10px); border:1px solid var(--border); display:inline-flex; align-items:center; gap:.35rem; }
    #app { min-height:100svh; display:flex; flex-direction:column; }
    header { display:flex; align-items:center; justify-content:space-between; padding:.85rem clamp(.9rem,2.5vw,2rem); gap:1rem; position:relative; z-index:10; }
    #callBar { display:none; align-items:center; gap:.65rem; flex-wrap:wrap; }
    #callBar.active { display:flex; }
    #timer { font-variant-numeric:tabular-nums; font-size:.95rem; font-weight:600; background:var(--glass); border:1px solid var(--border); padding:.5rem 1rem; border-radius:1rem; box-shadow:0 0 0 1px rgba(255,255,255,.04), 0 4px 18px -4px #1e40af; }
    #statusDot { width:.55rem; height:.55rem; border-radius:50%; background:#475569; box-shadow:0 0 0 4px rgba(71,85,105,0.25); }
    #statusDot.connected { background:#10b981; box-shadow:0 0 0 4px rgba(16,185,129,0.25); }
    #statusDot.connecting { background:#fbbf24; box-shadow:0 0 0 4px rgba(251,191,36,0.25); }
    #statusDot.err { background:#ef4444; box-shadow:0 0 0 4px rgba(239,68,68,0.25); }
    #landing { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:clamp(1rem,4vw,3rem) 1rem 4rem; text-align:center; gap:1.5rem; }
  #landing h2 { margin:0; font-size:clamp(1.35rem,4vw,2rem); background:linear-gradient(90deg,#93c5fd,#c4b5fd); -webkit-background-clip:text; background-clip:text; color:transparent; font-weight:700; letter-spacing:.5px; }
    #startBtn { width:190px; height:190px; border-radius:50%; font-size:1rem; background:radial-gradient(circle at 35% 30%,#2563eb 0%,#1d4ed8 60%,#1e3a8a 100%); box-shadow:0 0 0 0 rgba(59,130,246,.5); animation:pulse 2.2s infinite; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:.35rem; }
    #startBtn span.small { font-size:.65rem; opacity:.8; font-weight:400; letter-spacing:.5px; }
    @keyframes pulse { 0%{ box-shadow:0 0 0 0 rgba(59,130,246,.55);} 70%{ box-shadow:0 0 0 70px rgba(59,130,246,0);} 100%{ box-shadow:0 0 0 0 rgba(59,130,246,0);} }
    .hidden { display:none !important; }
  #inCall { flex:1; display:flex; flex-direction:column; position:relative; padding:0 clamp(.75rem,2.8vw,2rem) clamp(.8rem,2vw,1.2rem); gap:.75rem; }
  #infoPanel { flex:1 1 auto; min-height:55vh; background:var(--panel); backdrop-filter:blur(18px) saturate(160%); border:1px solid var(--border); border-radius:1.3rem; padding:1.15rem 1.2rem 1.25rem; display:flex; flex-direction:column; box-shadow:0 4px 34px -6px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.04); }
  /* Glow states */
  #infoPanel.glow-blue { box-shadow:0 0 0 2px rgba(59,130,246,.8),0 0 18px 4px rgba(59,130,246,.45),0 4px 34px -6px rgba(0,0,0,.55); transition:box-shadow .45s; animation:glowPulse 3.2s ease-in-out infinite; }
  #infoPanel.glow-green { box-shadow:0 0 0 2px rgba(16,185,129,.85),0 0 18px 4px rgba(16,185,129,.45),0 4px 34px -6px rgba(0,0,0,.55); transition:box-shadow .45s; animation:glowPulse 3.2s ease-in-out infinite; }
  #infoPanel.glow-purple { box-shadow:0 0 0 2px rgba(139,92,246,.85),0 0 18px 4px rgba(139,92,246,.45),0 4px 34px -6px rgba(0,0,0,.55); transition:box-shadow .45s; animation:glowPulse 3.2s ease-in-out infinite; }
  /* Stronger slower pulse ONLY while booking_pending (amber) */
  #infoPanel.glow-amber { box-shadow:0 0 0 2px rgba(245,158,11,.9),0 0 20px 6px rgba(245,158,11,.55),0 4px 34px -6px rgba(0,0,0,.55); transition:box-shadow .45s; animation:amberPulse 2.4s ease-in-out infinite; }
  @keyframes glowPulse { 0%,100%{ filter:brightness(1);} 50%{ filter:brightness(1.13);} }
  @keyframes amberPulse { 0%{ filter:brightness(1); box-shadow:0 0 0 2px rgba(245,158,11,.75),0 0 14px 3px rgba(245,158,11,.35),0 4px 34px -6px rgba(0,0,0,.55);} 50%{ filter:brightness(1.28); box-shadow:0 0 0 3px rgba(245,158,11,1),0 0 28px 10px rgba(245,158,11,.75),0 4px 40px -4px rgba(0,0,0,.65);} 100%{ filter:brightness(1); box-shadow:0 0 0 2px rgba(245,158,11,.75),0 0 14px 3px rgba(245,158,11,.35),0 4px 34px -6px rgba(0,0,0,.55);} }
    #infoPanel h3 { margin:.1rem 0 1rem; font-size:1rem; font-weight:650; letter-spacing:.7px; }
  #infoBody { flex:1; overflow:auto; scrollbar-width:thin; font-size:.78rem; line-height:1.5; }
  #infoBody::-webkit-scrollbar { width:8px; }
  #infoBody::-webkit-scrollbar-track { background:rgba(255,255,255,0.03); }
  #infoBody::-webkit-scrollbar-thumb { background:rgba(148,163,184,0.28); border-radius:20px; }
  #waveBar { position:relative; height:110px; background:linear-gradient(to bottom,#0f172acc,#0f172aef); border:1px solid var(--border); border-radius:1.2rem; overflow:hidden; display:flex; align-items:center; justify-content:center; }
  #waveCanvas { width:100%; height:100%; }
  .hangup-btn { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:78px; height:78px; border-radius:50%; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; background:linear-gradient(145deg,#dc2626,#991b1b); color:#fff; box-shadow:0 6px 20px -6px rgba(0,0,0,.6),0 0 0 5px rgba(239,68,68,0.22); transition:.3s; }
  .hangup-btn img { width:68%; height:68%; object-fit:contain; filter:drop-shadow(0 2px 4px rgba(0,0,0,.55)); position:relative; left:-2px; top:2px; }
  .hangup-btn:hover { box-shadow:0 8px 28px -6px rgba(0,0,0,.75),0 0 0 8px rgba(239,68,68,0.35); }
  .hangup-btn:active { transform:translate(-50%,-50%) scale(.94); }
  #waveBar:after { content:""; position:absolute; inset:0; background:linear-gradient(135deg,rgba(59,130,246,.07),rgba(139,92,246,.07)); pointer-events:none; }
  #remoteAudio { display:none; }
  .grid-two { display:grid; grid-template-columns:1fr 1fr; gap:.55rem .9rem; font-size:.72rem; }
    .grid-two label { display:block; text-transform:uppercase; font-size:.55rem; opacity:.6; letter-spacing:.6px; margin-bottom:.15rem; }
    .badge { display:inline-block; padding:.2rem .6rem; font-size:.55rem; font-weight:600; letter-spacing:.5px; border-radius:999px; background:#334155; text-transform:uppercase; }
    .badge.ok { background:var(--ok); color:#022c1a; }
    .badge.wait { background:var(--warn); color:#3b2f02; }
    .badge.err { background:var(--err); }
    #bookingPanel { left:auto; right:1rem; top:1.2rem; }
    .actionsRow { display:flex; gap:.5rem; margin-top:.75rem; }
    .ghost { background:var(--glass); border:1px solid var(--border); box-shadow:none; font-weight:500; }
    .ghost:hover:before { opacity:0; }
    #logToggle { background:var(--glass); color:#e2e8f0; border:1px solid var(--border); font-size:.65rem; padding:.5rem .8rem; }
    #logPanel { position:absolute; bottom:1rem; right:1rem; width: min(380px, 90vw); max-height:42vh; display:flex; flex-direction:column; background:var(--panel); backdrop-filter:blur(14px); border:1px solid var(--border); border-radius:1rem; overflow:hidden; box-shadow:0 4px 30px -8px rgba(0,0,0,.6); opacity:0; transform:translateY(8px); transition:.4s; }
    #logPanel.show { opacity:1; transform:translateY(0); }
    #logHeader { display:flex; align-items:center; justify-content:space-between; padding:.65rem .9rem; font-size:.65rem; letter-spacing:.5px; text-transform:uppercase; background:linear-gradient(90deg,#1e293b,#0f172a); }
    #log { margin:0; padding:.6rem .75rem 1rem; list-style:none; font-size:.62rem; line-height:1.25; overflow:auto; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    #log li { margin:.15rem 0; opacity:.85; }
    /* Booking cards with images */
    .bk-wrapper { display:flex; flex-direction:column; gap:.7rem; }
    .bk-note { font-size:.58rem; opacity:.7; line-height:1.35; }
  .bk-grid { display:grid; gap:1rem; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); }
  .bk-card { position:relative; display:flex; flex-direction:column; background:linear-gradient(160deg,rgba(255,255,255,0.07),rgba(255,255,255,0.03)); border:1px solid var(--border); border-radius:1rem; overflow:hidden; backdrop-filter:blur(12px) saturate(160%); box-shadow:0 5px 18px -6px rgba(0,0,0,.55),0 0 0 1px rgba(255,255,255,0.05); transition:.3s; cursor:default; }
    .bk-card:hover { box-shadow:0 6px 18px -6px rgba(0,0,0,.65),0 0 0 1px rgba(255,255,255,0.07); transform:translateY(-2px); }
    .bk-card.chosen { border-color:#3b82f6; box-shadow:0 0 0 2px rgba(59,130,246,.65),0 10px 28px -6px rgba(59,130,246,.55); }
  .bk-img { position:relative; width:100%; aspect-ratio: 3/2; background:#1e293b; overflow:hidden; }
    .bk-img img,.bk-img .no-img-fallback { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block; filter:contrast(1.05) saturate(1.05); }
    .bk-img .no-img-fallback { background:repeating-linear-gradient(45deg,#1e293b,#1e293b 10px,#334155 10px,#334155 20px); }
    .bk-img:after { content:""; position:absolute; inset:0; background:linear-gradient(to bottom, rgba(0,0,0,0) 40%, rgba(0,0,0,0.55) 85%, rgba(0,0,0,0.85) 100%); }
    .bk-hosp-overlay { position:absolute; left:.9rem; right:.9rem; bottom:.75rem; font-weight:650; font-size:1.05rem; letter-spacing:.6px; z-index:2; text-shadow:0 3px 10px rgba(0,0,0,.75); line-height:1.2; }
    .bk-badge { position:absolute; top:.65rem; right:.65rem; font-size:.7rem; background:#2563eb; color:#fff; padding:.35rem .65rem; border-radius:.7rem; letter-spacing:.55px; font-weight:650; box-shadow:0 3px 8px -2px rgba(0,0,0,.55); z-index:2; }
  .bk-meta { display:flex; flex-direction:column; gap:.3rem; padding:.6rem .7rem .7rem; font-size:.82rem; line-height:1.35; min-height:calc(50% - .55rem); }
    .bk-line span { opacity:.55; margin-right:.25rem; }
    .bk-score { position:absolute; top:.7rem; left:.75rem; font-size:.75rem; background:rgba(15,23,42,0.55); padding:.3rem .55rem; border-radius:.7rem; backdrop-filter:blur(6px); z-index:2; }
    .bk-speak { font-size:.85rem; opacity:.75; line-height:1.4; }
    @media (max-width:620px){
      .bk-grid { grid-template-columns:repeat(2,1fr); gap:.6rem; }
      .bk-card { border-radius:.9rem; }
      .bk-img { aspect-ratio: 16/11; }
      .bk-meta { font-size:.72rem; padding:.55rem .55rem .6rem; }
      .bk-hosp-overlay { font-size:.85rem; }
    }
    /* Mobile tweaks */
    @media (max-width:780px){
      header { flex-direction:column; align-items:stretch; gap:.75rem; }
      #callBar { width:100%; justify-content:space-between; }
      #timer { order:2; flex:1; text-align:center; }
  #infoPanel { min-height:52vh; }
  #waveBar { height:84px; overflow:visible; }
  .hangup-btn { width:82px; height:82px; }
  .hangup-btn img { width:70%; height:70%; position:relative; left:-3px; top:1px; }
  /* Identity stacked block for name & phone two lines */
  .identity-block { display:flex; flex-direction:column; gap:.55rem; padding:.4rem 0 .2rem; }
  .identity-line { font-size:1.15rem; font-weight:600; letter-spacing:.4px; }
  .identity-label { display:block; font-size:.55rem; opacity:.55; text-transform:uppercase; letter-spacing:.55px; margin-bottom:.15rem; }
  @media (max-width:620px){ .identity-line { font-size:1.05rem; } }
      #logPanel { width:calc(100% - 2rem); right:50%; transform:translate(50%,8px); }
      #logPanel.show { transform:translate(50%,0); }
      #startBtn { width:150px; height:150px; }
    }
    /* Circle expand transition */
    #startBtn.expanding { animation:none; position:relative; z-index:50; overflow:visible; }
  #startBtn.expanding:after { content:""; position:absolute; inset:0; border-radius:50%; background:radial-gradient(circle at 35% 30%,#2563eb 0%,#1d4ed8 60%,#1e3a8a 100%); animation:circleExpand 1.4s ease-out forwards; }
    #startBtn.expanding > * { opacity:0; transition:.25s; }
  @keyframes circleExpand { 0%{ transform:scale(1); opacity:1; } 55%{ transform:scale(10); opacity:1; } 80%{ transform:scale(18); opacity:.95; } 100%{ transform:scale(24); opacity:0; } }
    body.transitioning #landing { pointer-events:none; }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <div style="display:flex; align-items:center; gap:.8rem;">
        <div id="statusDot" class="connecting"></div>
        <h1>Bác sĩ Ảo</h1>
      </div>
      <div id="callBar">
        <div id="timer">00:00</div>
        <div style="display:flex; gap:.5rem;">
          <button id="btnMute" class="ghost">Tắt mic</button>
          <button id="btnUnmute" class="ghost hidden">Bật mic</button>
          <button id="btnLog" class="ghost" style="min-width:42px;">Log</button>
        </div>
      </div>
    </header>
    <section id="landing" class="fade-in">
      <h2>Bác sĩ Ảo Trực Tuyến</h2>
  <p style="max-width:520px; font-size:1rem; line-height:1.55; opacity:.9; font-weight:450;">Nhấn để bắt đầu cuộc gọi âm thanh bảo mật. Hệ thống sẽ hỏi thông tin cơ bản và đặt lịch khám nếu cần.</p>
      <button id="startBtn">
        BẮT ĐẦU
        <span class="small">Cho phép Micro</span>
      </button>
    </section>
    <section id="inCall" class="hidden">
      <div id="infoPanel">
        <h3 id="infoTitle">Thông tin</h3>
        <div id="infoBody" style="font-size:.7rem; opacity:.85;">Đang nhận dữ liệu...</div>
        <div class="actionsRow" id="infoActions" style="display:none;"></div>
      </div>
      <div id="waveBar">
        <canvas id="waveCanvas"></canvas>
        <audio id="remoteAudio" autoplay playsinline></audio>
        <button id="btnEndCall" aria-label="Kết thúc" title="Kết thúc" class="hangup-btn">
          <img src="icons/phone_white.svg" alt="Kết thúc" />
        </button>
      </div>
      <div id="logPanel">
        <div id="logHeader">LOG HỆ THỐNG <button id="btnCloseLog" class="ghost" style="padding:.35rem .6rem; font-size:.55rem;">Đóng</button></div>
        <ul id="log"></ul>
      </div>
    </section>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
